---
import Layout from "@/layouts/Layout.astro";
import { DashboardView } from "@/components/views/DashboardView";

// Server-side authentication check
const supabase = Astro.locals.supabase;
const { data: { session } } = await supabase.auth.getSession();

// If no session, redirect to sign-in page
if (!session) {
  return Astro.redirect("/signin");
}

const accessToken = session.access_token;
---

<Layout title="Dashboard">
  <DashboardView client:load accessToken={accessToken} />
</Layout>
